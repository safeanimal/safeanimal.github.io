---
import type { Publication } from "@common/index";
import Card from "@components/UI/Card.astro";
import { AuthorFormatter } from "@utils/formatters";
import { profile } from "@data/profile";

interface Props {
  publication: Publication;
}

const { publication } = Astro.props;

const typeLabels: Record<Publication["type"], string> = {
  conference: "Conference",
  journal: "Journal",
  workshop: "Workshop",
  preprint: "Preprint",
  book: "Book",
  "book-chapter": "Book Chapter",
};
---

<Card hover={true} padding="lg">
  <article class="publication">
    <div class="publication-header">
      <span class={`type-badge type-badge--${publication.type}`}>
        {typeLabels[publication.type]}
      </span>
      {publication.featured && <span class="featured-badge">Featured</span>}
    </div>

    <h3 class="publication-title">{publication.title}</h3>

    <p
      class="publication-authors"
      set:html={AuthorFormatter.formatAuthors(
        publication.authors,
        profile.name,
        publication.authorAnnotations,
        publication.yourPenName
      )}
    />

    {
      publication.authorNote && (
        <p class="author-note">{publication.authorNote}</p>
      )
    }

    <p class="publication-venue">
      {publication.venue}, {publication.year}
    </p>

    {publication.note && <p class="publication-note">{publication.note}</p>}

    {
      publication.abstract && (
        <p class="publication-abstract">{publication.abstract}</p>
      )
    }

    <div class="publication-links">
      {
        publication.paper && (
          <a
            href={publication.paper}
            class="pub-link"
            target="_blank"
            rel="noopener"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <polyline points="14 2 14 8 20 8" />
            </svg>
            Paper
          </a>
        )
      }

      {
        publication.code && (
          <a
            href={publication.code}
            class="pub-link"
            target="_blank"
            rel="noopener"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="16 18 22 12 16 6" />
              <polyline points="8 6 2 12 8 18" />
            </svg>
            Code
          </a>
        )
      }

      {
        publication.website && (
          <a
            href={publication.website}
            class="pub-link"
            target="_blank"
            rel="noopener"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10" />
              <line x1="2" y1="12" x2="22" y2="12" />
              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
            </svg>
            Website
          </a>
        )
      }

      {
        publication.arxiv && (
          <a
            href={publication.arxiv}
            class="pub-link"
            target="_blank"
            rel="noopener"
          >
            arXiv
          </a>
        )
      }
    </div>
  </article>
</Card>

<style>
  .publication {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-3);
  }

  .publication-header {
    display: flex;
    gap: var(--spacing-2);
    align-items: center;
  }

  .type-badge {
    display: inline-block;
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-full);
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .type-badge--conference {
    background: rgba(59, 130, 246, 0.1);
    color: rgb(59, 130, 246);
  }

  .type-badge--journal {
    background: rgba(16, 185, 129, 0.1);
    color: rgb(16, 185, 129);
  }

  .type-badge--workshop {
    background: rgba(245, 158, 11, 0.1);
    color: rgb(245, 158, 11);
  }

  .type-badge--preprint {
    background: rgba(139, 92, 246, 0.1);
    color: rgb(139, 92, 246);
  }

  .type-badge--book {
    background: rgba(236, 72, 153, 0.1);
    color: rgb(236, 72, 153);
  }

  .type-badge--book-chapter {
    background: rgba(168, 85, 247, 0.1);
    color: rgb(168, 85, 247);
  }

  .featured-badge {
    display: inline-block;
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-full);
    font-size: var(--font-size-xs);
    font-weight: 600;
    background: rgba(239, 68, 68, 0.1);
    color: rgb(239, 68, 68);
  }

  .publication-title {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
    line-height: 1.4;
  }

  .publication-authors {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin: 0;
  }

  .publication-authors sup {
    font-size: var(--font-size-xs);
    color: var(--color-primary);
    font-weight: 600;
    margin-left: 1px;
  }

  .author-note {
    font-size: var(--font-size-xs);
    color: var(--color-text-tertiary);
    margin: 0;
    font-style: italic;
  }

  .publication-venue {
    font-size: var(--font-size-sm);
    color: var(--color-text-tertiary);
    font-style: italic;
    margin: 0;
  }

  .publication-note {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    font-style: italic;
    margin: 0;
    padding: var(--spacing-2) var(--spacing-3);
    background: var(--color-surface-variant);
    border-radius: var(--radius-sm);
  }

  .publication-abstract {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin: 0;
  }

  .publication-links {
    display: flex;
    gap: var(--spacing-3);
    flex-wrap: wrap;
    margin-top: var(--spacing-2);
  }

  .pub-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    padding: var(--spacing-2) var(--spacing-3);
    background: var(--color-surface-variant);
    color: var(--color-primary);
    text-decoration: none;
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    font-weight: 500;
    transition: all var(--transition-fast);
  }

  .pub-link:hover {
    background: var(--color-primary);
    color: white;
  }

  .pub-link svg {
    width: 14px;
    height: 14px;
  }
</style>
